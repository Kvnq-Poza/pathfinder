<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PathFinder — Tool</title>
    <meta
      name="description"
      content="Explore, query, and generate access paths for nested JSON structures."
    />
    <link rel="icon" href="public/favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="stylesheet" href="src/styles/variables.css" />
    <link rel="stylesheet" href="src/styles/global.css" />
    <link rel="stylesheet" href="src/styles/components.css" />
    <style>
      html,
      body {
        height: 100%;
        overflow: hidden;
      }
      body {
        display: flex;
        flex-direction: column;
      }
      /* Override body::before so it doesn't block interaction */
      body::before {
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <!-- ===== APP NAV ===== -->
    <nav class="app-nav">
      <a href="index.html" class="app-logo" title="Back to home">
        <div class="logo-mark">
          <img src="public/logo.png" alt="PathFinder" width="24" height="24" />
        </div>
        <span>PathFinder</span>
      </a>

      <div class="app-tabs" id="app-tabs">
        <div class="app-tab active" data-tab="tree">
          <i class="fa-solid fa-sitemap fa-xs"></i> Tree
        </div>
        <div class="app-tab" data-tab="schema">
          <i class="fa-brands fa-js fa-xs"></i> Schema
        </div>
      </div>

      <div class="app-actions">
        <div class="shortcuts" id="shortcuts">
          <span class="shortcut"><kbd>Ctrl+F</kbd> search</span>
          <span class="shortcut"><kbd>Ctrl+/</kbd> collapse</span>
        </div>
        <button class="icon-btn" id="file-trigger-btn" title="Load JSON file">
          <i class="fa-solid fa-folder-open"></i>
          <span class="label">File</span>
        </button>
        <button class="icon-btn danger" id="clear-btn" title="Clear JSON">
          <i class="fa-solid fa-xmark"></i> <span class="label">Clear</span>
        </button>
      </div>
    </nav>

    <!-- ===== APP LAYOUT ===== -->
    <div class="app-layout" id="app-layout">
      <!-- DROP / LOAD ZONE (shown when no JSON) -->
      <div id="drop-zone">
        <div class="drop-icon"><i class="fa-solid fa-file-code"></i></div>
        <div class="drop-title">Drop a JSON file here</div>
        <div class="drop-sub">
          or click to browse&nbsp;&nbsp;<kbd>.json</kbd>
        </div>
        <div class="drop-divider">or paste JSON below</div>
        <textarea
          class="paste-area"
          id="paste-area"
          placeholder='{"user": {"id": 1, "name": "Alice"}, "tags": ["json", "parser"]}'
        >
        </textarea>
        <div id="error-msg"></div>
        <div class="drop-parse-row">
          <button class="btn-primary" id="parse-btn">
            <i class="fa-solid fa-play"></i> Parse JSON
          </button>
          <button class="btn-ghost" id="load-sample-btn">
            <i class="fa-solid fa-flask"></i> Load Sample
          </button>
        </div>
      </div>

      <!-- TREE PANEL (shown when JSON is loaded) -->
      <div id="tree-panel">
        <div class="tree-toolbar">
          <div class="search-wrap">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input
              type="text"
              class="search-input"
              id="search-input"
              placeholder="Search keys and values…"
              autocomplete="off"
              spellcheck="false"
            />
            <button class="search-clear" id="search-clear" title="Clear search">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          <span class="tree-info" id="tree-info">—</span>
          <button class="icon-btn" id="collapse-all-btn" title="Collapse all">
            <i class="fa-solid fa-compress"></i>
          </button>
          <button class="icon-btn" id="expand-all-btn" title="Expand all">
            <i class="fa-solid fa-expand"></i>
          </button>
        </div>

        <!-- Virtual scroll -->
        <div class="virtual-scroll" id="virtual-scroll">
          <div class="virtual-spacer" id="virtual-spacer">
            <div class="v-nodes-container" id="v-nodes-container"></div>
          </div>
        </div>
      </div>

      <!-- SCHEMA VIEW (hidden until tab switch on desktop; separate view on mobile) -->
      <div class="schema-page" id="schema-page">
        <div class="schema-page-header">
          <div>
            <div class="schema-page-title">
              <i class="fa-brands fa-js"></i> TypeScript Schema
            </div>
            <div class="schema-page-sub" id="schema-page-sub">
              Load JSON to generate interface definitions
            </div>
          </div>
          <button class="btn-ghost" id="copy-schema-btn" disabled>
            <i class="fa-regular fa-copy"></i> Copy Schema
          </button>
        </div>
        <div class="schema-code-block" id="schema-output">
          <span style="color: var(--text-dim); font-style: italic"
            >// Schema will appear here once JSON is loaded…</span
          >
        </div>
      </div>

      <!-- RIGHT SIDEBAR PANEL -->
      <div class="right-panel" id="right-panel">
        <!-- PATH OUTPUT -->
        <div class="panel-section">
          <div class="panel-header">
            <span><i class="fa-solid fa-route fa-xs"></i> path_output</span>
          </div>
          <div class="path-display" id="path-display">
            <div class="path-empty">
              <i class="fa-solid fa-hand-pointer fa-xs"></i> Select a node in
              the tree
            </div>
          </div>
        </div>

        <!-- NODE VALUE -->
        <div class="panel-section">
          <div class="panel-header">
            <span><i class="fa-solid fa-database fa-xs"></i> node_value</span>
            <span id="value-type-badge-wrap"></span>
          </div>
          <div class="value-display" id="value-display">
            <div class="value-empty">No node selected</div>
          </div>
        </div>

        <!-- SCHEMA (sidebar, desktop only) -->
        <div class="schema-panel" id="sidebar-schema-panel">
          <div class="panel-header">
            <span><i class="fa-brands fa-js fa-xs"></i> typescript_schema</span>
            <button class="copy-mini">
              <i class="fa-regular fa-copy"></i> copy
            </button>
          </div>
          <div class="schema-output" id="sidebar-schema-output">
            <span style="color: var(--text-dim); font-style: italic"
              >Load JSON to generate schema…</span
            >
          </div>
        </div>
      </div>
    </div>
    <!-- /app-layout -->

    <!-- Mobile FAB to open right panel -->
    <button
      class="panel-toggle"
      id="panel-toggle"
      title="View paths &amp; schema"
    >
      <i class="fa-solid fa-code"></i>
    </button>
    <div class="drawer-overlay" id="drawer-overlay"></div>

    <input
      type="file"
      id="file-input"
      style="display: none"
      accept=".json,application/json"
    />
    <div id="toast"><i class="fa-solid fa-check"></i> Copied!</div>

    <script type="module" src="src/app.js"></script>
  </body>
</html>
